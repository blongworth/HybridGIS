---
title: "Helium displacement"
output:
  html_document:
    df_print: paged
---

Calculate concentration of CO2 in a vial/effluent when introducing helium as a displacement gas.

```{r, message=FALSE}
library(tidyverse)
```

I think this can be solved with ODE:

Change in volume of helium over time...

$$ C^\prime(t) = r - \frac{r}{V}C(t) $$

Add some math...

$$ C(t) = V(1-e^{-\frac{r}{V}t}) $$

The fraction of CO2 in the effluent should be:

$$ C(t) = e^{-\frac{r}{V}t} $$

Put this into functions.

```{r}
conc <- function(t, V = 7000, r = 100) {
  exp(-(r/V)*t)
}

concHe <- function(t, ...) {
  1 - conc(t)
}
```

Plotted as fraction of CO2 and helium

```{r}
data.frame(x = 0:400) %>% 
  ggplot(aes(x)) +
  stat_function(fun=conc, color = "blue") +
  stat_function(fun=concHe, color = "green") +
  labs(title = "Concentration of CO2 and Helium in vial over time",
       subtitle = "7mL vial, 100uL/min helium",
       x = "Time (min)",
       y = "Concentration (fractional)")
```

OK, what's the rate of flow of CO2 over time, in the effluent, and in a capillary taking Q/t ul/m?

If the vial is 7mL, flowing at 100ul/m and sampling 20ul/m with the open split, CO2 ul/m looks like:

```{r}
data.frame(x = 0:400) %>% 
  ggplot(aes(x)) +
  stat_function(fun=function(x) conc(x)*20, color = "green") +
  labs(title = "Flow of CO2 to source over time",
       subtitle = "7mL vial, 0.1mL/min helium, 20uL/min to source",
       x = "Time (min)",
       y = "Flow (uL/min)")
```

